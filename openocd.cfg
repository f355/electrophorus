adapter driver linuxgpiod

proc read_file { name } {
	if {[catch {open $name r} fd]} {
		return ""
	}
	set result [read $fd]
	close $fd
	return $result
}

proc find_rp1_alias {} {
	foreach f [glob -directory "/proc/device-tree/aliases" "gpio\[0-9\]"] {
		if {[string match "*/rp1/*" [read_file $f]]} {
			return $f
		}
	}
}

set pcie_aspm [read_file /sys/module/pcie_aspm/parameters/policy]
if {![string match {*\[performance\]*} $pcie_aspm]} {
	echo "Warn : Switch PCIe power saving off or the first couple of pulses gets clocked as fast as 20 MHz"
	echo "Warn : Issue 'echo performance | sudo tee /sys/module/pcie_aspm/parameters/policy'"
}

set GPIO_CHIP [string index [find_rp1_alias] end]

adapter gpio swclk -chip $GPIO_CHIP 24
adapter gpio swdio -chip $GPIO_CHIP 25
adapter gpio srst -chip $GPIO_CHIP 23

reset_config srst_only srst_push_pull

transport select swd
